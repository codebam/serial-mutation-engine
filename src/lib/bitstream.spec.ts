
import { describe, it, expect } from 'vitest';
import { Bitstream, UINT4_MIRROR, UINT5_MIRROR } from './bitstream';

// Helper function to convert hex string to Uint8Array
function hexToBytes(hex: string): Uint8Array {
    const bytes = new Uint8Array(Math.ceil(hex.length / 2));
    for (let i = 0; i < hex.length; i += 2) {
        bytes[i / 2] = parseInt(hex.substring(i, i + 2), 16);
    }
    return bytes;
}

// Go output data (truncated for brevity, will be filled with actual data)
const goOutput = `
varint,0,00
varbit,0,00
varint,1,80
varbit,1,01
varint,2,40
varbit,2,02
varint,3,c0
varbit,3,03
varint,4,20
varbit,4,04
varint,5,a0
varbit,5,05
varint,6,60
varbit,6,06
varint,7,e0
varbit,7,07
varint,8,10
varbit,8,08
varint,9,90
varbit,9,09
varint,10,50
varbit,10,0a
varint,11,d0
varbit,11,0b
varint,12,30
varbit,12,0c
varint,13,b0
varbit,13,0d
varint,14,70
varbit,14,0e
varint,15,f0
varbit,15,0f
varint,16,08
varbit,16,10
varint,17,88
varbit,17,11
varint,18,48
varbit,18,12
varint,19,c8
varbit,19,13
varint,20,28
varbit,20,14
varint,21,a8
varbit,21,15
varint,22,68
varbit,22,16
varint,23,e8
varbit,23,17
varint,24,18
varbit,24,18
varint,25,98
varbit,25,19
varint,26,58
varbit,26,1a
varint,27,d8
varbit,27,1b
varint,28,38
varbit,28,1c
varint,29,b8
varbit,29,1d
varint,30,78
varbit,30,1e
varint,31,f8
varbit,31,1f
varint,32,0c
varbit,32,20
varint,33,8c
varbit,33,21
varint,34,4c
varbit,34,22
varint,35,cc
varbit,35,23
varint,36,2c
varbit,36,24
varint,37,ac
varbit,37,25
varint,38,6c
varbit,38,26
varint,39,ec
varbit,39,27
varint,40,1c
varbit,40,28
varint,41,9c
varbit,41,29
varint,42,5c
varbit,42,2a
varint,43,dc
varbit,43,2b
varint,44,3c
varbit,44,2c
varint,45,bc
varbit,45,2d
varint,46,7c
varbit,46,2e
varint,47,fc
varbit,47,2f
varint,48,0a
varbit,48,30
varint,49,8a
varbit,49,31
varint,50,4a
varbit,50,32
varint,51,ca
varbit,51,33
varint,52,2a
varbit,52,34
varint,53,aa
varbit,53,35
varint,54,6a
varbit,54,36
varint,55,ea
varbit,55,37
varint,56,1a
varbit,56,38
varint,57,9a
varbit,57,39
varint,58,5a
varbit,58,3a
varint,59,da
varbit,59,3b
varint,60,3a
varbit,60,3c
varint,61,ba
varbit,61,3d
varint,62,7a
varbit,62,3e
varint,63,fa
varbit,63,3f
varint,64,0e
varbit,64,40
varint,65,8e
varbit,65,41
varint,66,4e
varbit,66,42
varint,67,ce
varbit,67,43
varint,68,2e
varbit,68,44
varint,69,ae
varbit,69,45
varint,70,6e
varbit,70,46
varint,71,ee
varbit,71,47
varint,72,1e
varbit,72,48
varint,73,9e
varbit,73,49
varint,74,5e
varbit,74,4a
varint,75,de
varbit,75,4b
varint,76,3e
varbit,76,4c
varint,77,be
varbit,77,4d
varint,78,7e
varbit,78,4e
varint,79,fe
varbit,79,4f
varint,80,09
varbit,80,50
varint,81,89
varbit,81,51
varint,82,49
varbit,82,52
varint,83,c9
varbit,83,53
varint,84,29
varbit,84,54
varint,85,a9
varbit,85,55
varint,86,69
varbit,86,56
varint,87,e9
varbit,87,57
varint,88,19
varbit,88,58
varint,89,99
varbit,89,59
varint,90,59
varbit,90,5a
varint,91,d9
varbit,91,5b
varint,92,39
varbit,92,5c
varint,93,b9
varbit,93,5d
varint,94,79
varbit,94,5e
varint,95,f9
varbit,95,5f
varint,96,0d
varbit,96,60
varint,97,8d
varbit,97,61
varint,98,4d
varbit,98,62
varint,99,cd
varbit,99,63
varint,100,2d
varbit,100,64
varint,101,ad
varbit,101,65
varint,102,6d
varbit,102,66
varint,103,ed
varbit,103,67
varint,104,1d
varbit,104,68
varint,105,9d
varbit,105,69
varint,106,5d
varbit,106,6a
varint,107,dd
varbit,107,6b
varint,108,3d
varbit,108,6c
varint,109,bd
varbit,109,6d
varint,110,7d
varbit,110,6e
varint,111,fd
varbit,111,6f
varint,112,0b
varbit,112,70
varint,113,8b
varbit,113,71
varint,114,4b
varbit,114,72
varint,115,cb
varbit,115,73
varint,116,2b
varbit,116,74
varint,117,ab
varbit,117,75
varint,118,6b
varbit,118,76
varint,119,eb
varbit,119,77
varint,120,1b
varbit,120,78
varint,121,9b
varbit,121,79
varint,122,5b
varbit,122,7a
varint,123,db
varbit,123,7b
varint,124,3b
varbit,124,7c
varint,125,bb
varbit,125,7d
varint,126,7b
varbit,126,7e
varint,127,fb
varbit,127,7f
varint,128,0f
varbit,128,80
varint,129,8f
varbit,129,81
varint,130,4f
varbit,130,82
varint,131,cf
varbit,131,83
varint,132,2f
varbit,132,84
varint,133,af
varbit,133,85
varint,134,6f
varbit,134,86
varint,135,ef
varbit,135,87
varint,136,1f
varbit,136,88
varint,137,9f
varbit,137,89
varint,138,5f
varbit,138,8a
varint,139,df
varbit,139,8b
varint,140,3f
varbit,140,8c
varint,141,bf
varbit,141,8d
varint,142,7f
varbit,142,8e
varint,143,ff
varbit,143,8f
varint,144,0850
varbit,144,90
varint,145,8850
varbit,145,91
varint,146,4850
varbit,146,92
varint,147,c850
varbit,147,93
varint,148,2850
varbit,148,94
varint,149,a850
varbit,149,95
varint,150,6850
varbit,150,96
varint,151,e850
varbit,151,97
varint,152,1850
varbit,152,98
varint,153,9850
varbit,153,99
varint,154,5850
varbit,154,9a
varint,155,d850
varbit,155,9b
varint,156,3850
varbit,156,9c
varint,157,b850
varbit,157,9d
varint,158,7850
varbit,158,9e
varint,159,f850
varbit,159,9f
varint,160,0c50
varbit,160,a0
varint,161,8c50
varbit,161,a1
varint,162,4c50
varbit,162,a2
varint,163,cc50
varbit,163,a3
varint,164,2c50
varbit,164,a4
varint,165,ac50
varbit,165,a5
varint,166,6c50
varbit,166,a6
varint,167,ec50
varbit,167,a7
varint,168,1c50
varbit,168,a8
varint,169,9c50
varbit,169,a9
varint,170,5c50
varbit,170,aa
varint,171,dc50
varbit,171,ab
varint,172,3c50
varbit,172,ac
varint,173,bc50
varbit,173,ad
varint,174,7c50
varbit,174,ae
varint,175,fc50
varbit,175,af
varint,176,0a50
varbit,176,b0
varint,177,8a50
varbit,177,b1
varint,178,4a50
varbit,178,b2
varint,179,ca50
varbit,179,b3
varint,180,2a50
varbit,180,b4
varint,181,aa50
varbit,181,b5
varint,182,6a50
varbit,182,b6
varint,183,ea50
varbit,183,b7
varint,184,1a50
varbit,184,b8
varint,185,9a50
varbit,185,b9
varint,186,5a50
varbit,186,ba
varint,187,da50
varbit,187,bb
varint,188,3a50
varbit,188,bc
varint,189,ba50
varbit,189,bd
varint,190,7a50
varbit,190,be
varint,191,fa50
varbit,191,bf
varint,192,0e50
varbit,192,c0
varint,193,8e50
varbit,193,c1
varint,194,4e50
varbit,194,c2
varint,195,ce50
varbit,195,c3
varint,196,2e50
varbit,196,c4
varint,197,ae50
varbit,197,c5
varint,198,6e50
varbit,198,c6
varint,199,ee50
varbit,199,c7
varint,200,1e50
varbit,200,c8
varint,201,9e50
varbit,201,c9
varint,202,5e50
varbit,202,ca
varint,203,de50
varbit,203,cb
varint,204,3e50
varbit,204,cc
varint,205,be50
varbit,205,cd
varint,206,7e50
varbit,206,ce
varint,207,fe50
varbit,207,cf
varint,208,0950
varbit,208,d0
varint,209,8950
varbit,209,d1
varint,210,4950
varbit,210,d2
varint,211,c950
varbit,211,d3
varint,212,2950
varbit,212,d4
varint,213,a950
varbit,213,d5
varint,214,6950
varbit,214,d6
varint,215,e950
varbit,215,d7
varint,216,1950
varbit,216,d8
varint,217,9950
varbit,217,d9
varint,218,5950
varbit,218,da
varint,219,d950
varbit,219,db
varint,220,3950
varbit,220,dc
varint,221,b950
varbit,221,dd
varint,222,7950
varbit,222,de
varint,223,f950
varbit,223,df
varint,224,0d50
varbit,224,e0
varint,225,8d50
varbit,225,e1
varint,226,4d50
varbit,226,e2
varint,227,cd50
varbit,227,e3
varint,228,2d50
varbit,228,e4
varint,229,ad50
varbit,229,e5
varint,230,6d50
varbit,230,e6
varint,231,ed50
varbit,231,e7
varint,232,1d50
varbit,232,e8
varint,233,9d50
varbit,233,e9
varint,234,5d50
varbit,234,ea
varint,235,dd50
varbit,235,eb
varint,236,3d50
varbit,236,ec
varint,237,bd50
varbit,237,ed
varint,238,7d50
varbit,238,ee
varint,239,fd50
varbit,239,ef
varint,240,0b50
varbit,240,f0
varint,241,8b50
varbit,241,f1
varint,242,4b50
varbit,242,f2
varint,243,cb50
varbit,243,f3
varint,244,2b50
varbit,244,f4
varint,245,ab50
varbit,245,f5
varint,246,6b50
varbit,246,f6
varint,247,eb50
varbit,247,f7
varint,248,1b50
varbit,248,f8
varint,249,9b50
varbit,249,f9
varint,250,5b50
varbit,250,fa
varint,251,db50
varbit,251,fb
varint,252,3b50
varbit,252,fc
varint,253,bb50
varbit,253,fd
varint,254,7b50
varbit,254,fe
varint,255,fb50
varbit,255,ff
varint,256,0850
varbit,256,5001
varint,257,8850
varbit,257,5401
varint,258,4850
varbit,258,5201
varint,259,c850
varbit,259,5601
varint,260,2850
varbit,260,5101
varint,261,a850
varbit,261,5501
varint,262,6850
varbit,262,5301
varint,263,e850
varbit,263,5701
varint,264,1850
varbit,264,5081
varint,265,9850
varbit,265,5481
varint,266,5850
varbit,266,5281
varint,267,d850
varbit,267,5681
varint,268,3850
varbit,268,5181
varint,269,b850
varbit,269,5581
varint,270,7850
varbit,270,5381
varint,271,f850
varbit,271,5781
varint,272,0c50
varbit,272,5041
varint,273,8c50
varbit,273,5441
varint,274,4c50
varbit,274,5241
varint,275,cc50
varbit,275,5641
varint,276,2c50
varbit,276,5141
varint,277,ac50
varbit,277,5541
varint,278,6c50
varbit,278,5341
varint,279,ec50
varbit,279,5741
varint,280,1c50
varbit,280,50c1
varint,281,9c50
varbit,281,54c1
varint,282,5c50
varbit,282,52c1
varint,283,dc50
varbit,283,56c1
varint,284,3c50
varbit,284,51c1
varint,285,bc50
varbit,285,55c1
varint,286,7c50
varbit,286,53c1
varint,287,fc50
varbit,287,57c1
varint,288,0a50
varbit,288,5021
varint,289,8a50
varbit,289,5421
varint,290,4a50
varbit,290,5221
varint,291,ca50
varbit,291,5621
varint,292,2a50
varbit,292,5121
varint,293,aa50
varbit,293,5521
varint,294,6a50
varbit,294,5321
varint,295,ea50
varbit,295,5721
varint,296,1a50
varbit,296,50a1
varint,297,9a50
varbit,297,54a1
varint,298,5a50
varbit,298,52a1
varint,299,da50
varbit,299,56a1
varint,300,3a50
varbit,300,51a1
varint,301,ba50
varbit,301,55a1
varint,302,7a50
varbit,302,53a1
varint,303,fa50
varbit,303,57a1
varint,304,0e50
varbit,304,5061
varint,305,8e50
varbit,305,5461
varint,306,4e50
varbit,306,5261
varint,307,ce50
varbit,307,5661
varint,308,2e50
varbit,308,5161
varint,309,ae50
varbit,309,5561
varint,310,6e50
varbit,310,5361
varint,311,ee50
varbit,311,5761
varint,312,1e50
varbit,312,50e1
varint,313,9e50
varbit,313,54e1
varint,314,5e50
varbit,314,52e1
varint,315,de50
varbit,315,56e1
varint,316,3e50
varbit,316,51e1
varint,317,be50
varbit,317,55e1
varint,318,7e50
varbit,318,53e1
varint,319,fe50
varbit,319,57e1
varint,320,0950
varbit,320,5011
varint,321,8950
varbit,321,5411
varint,322,4950
varbit,322,5211
varint,323,c950
varbit,323,5611
varint,324,2950
varbit,324,5111
varint,325,a950
varbit,325,5511
varint,326,6950
varbit,326,5311
varint,327,e950
varbit,327,5711
varint,328,1950
varbit,328,5091
varint,329,9950
varbit,329,5491
varint,330,5950
varbit,330,5291
varint,331,d950
varbit,331,5691
varint,332,3950
varbit,332,5191
varint,333,b950
varbit,333,5591
varint,334,7950
varbit,334,5391
varint,335,f950
varbit,335,5791
varint,336,0d50
varbit,336,5051
varint,337,8d50
varbit,337,5451
varint,338,4d50
varbit,338,5251
varint,339,cd50
varbit,339,5651
varint,340,2d50
varbit,340,5151
varint,341,ad50
varbit,341,5551
varint,342,6d50
varbit,342,5351
varint,343,ed50
varbit,343,5751
varint,344,1d50
varbit,344,50d1
varint,345,9d50
varbit,345,54d1
varint,346,5d50
varbit,346,52d1
varint,347,dd50
varbit,347,56d1
varint,348,3d50
varbit,348,51d1
varint,349,bd50
varbit,349,55d1
varint,350,7d50
varbit,350,53d1
varint,351,fdd0
varbit,351,57d1
varint,352,0b50
varbit,352,5031
varint,353,8b50
varbit,353,5431
varint,354,4b50
varbit,354,5231
varint,355,cb50
varbit,355,5631
varint,356,2b50
varbit,356,5131
varint,357,ab50
varbit,357,5531
varint,358,6b50
varbit,358,5331
varint,359,eb50
varbit,359,5731
varint,360,1b50
varbit,360,50b1
varint,361,9b50
varbit,361,54b1
varint,362,5b50
varbit,362,52b1
varint,363,db50
varbit,363,56b1
varint,364,3b50
varbit,364,51b1
varint,365,bb50
varbit,365,55b1
varint,366,7b50
varbit,366,53b1
varint,367,fb50
varbit,367,57b1
varint,368,0f50
varbit,368,5071
varint,369,8f50
varbit,369,5471
varint,370,4f50
varbit,370,5271
varint,371,cf50
varbit,371,5671
varint,372,2f50
varbit,372,5171
varint,373,af50
varbit,373,5571
varint,374,6f50
varbit,374,5371
varint,375,ef50
varbit,375,5771
varint,376,1f50
varbit,376,50f1
varint,377,9f50
varbit,377,54f1
varint,378,5f50
varbit,378,52f1
varint,379,df50
varbit,379,56f1
varint,380,3f50
varbit,380,51f1
varint,381,bf50
varbit,381,55f1
varint,382,7f50
varbit,382,53f1
varint,383,ff50
varbit,383,57f1
varint,384,0850
varbit,384,5009
varint,385,8850
varbit,385,5409
varint,386,4850
varbit,386,5209
varint,387,c850
varbit,387,5609
varint,388,2850
varbit,388,5109
varint,389,a850
varbit,389,5509
varint,390,6850
varbit,390,5309
varint,391,e850
varbit,391,5709
varint,392,1850
varbit,392,5089
varint,393,9850
varbit,393,5489
varint,394,5850
varbit,394,5289
varint,395,d850
varbit,395,5689
varint,396,3850
varbit,396,5189
varint,397,b850
varbit,397,5589
varint,398,7850
varbit,398,5389
varint,399,f850
varbit,399,5789
varint,400,0c50
varbit,400,5049
varint,401,8c50
varbit,401,5449
varint,402,4c50
varbit,402,5249
varint,403,cc50
varbit,403,5649
varint,404,2c50
varbit,404,5149
varint,405,ac50
varbit,405,5549
varint,406,6c50
varbit,406,5349
varint,407,ec50
varbit,407,5749
varint,408,1c50
varbit,408,50c9
varint,409,9c50
varbit,409,54c9
varint,410,5c50
varbit,410,52c9
varint,411,dc50
varbit,411,56c9
varint,412,3c50
varbit,412,51c9
varint,413,bc50
varbit,413,55c9
varint,414,7c50
varbit,414,53c9
varint,415,fc50
varbit,415,57c9
varint,416,0a50
varbit,416,5029
varint,417,8a50
varbit,417,5429
varint,418,4a50
varbit,418,5229
varint,419,ca50
varbit,419,5629
varint,420,2a50
varbit,420,5129
varint,421,aa50
varbit,421,5529
varint,422,6a50
varbit,422,5329
varint,423,ea50
varbit,423,5729
varint,424,1a50
varbit,424,50a9
varint,425,9a50
varbit,425,54a9
varint,426,5a50
varbit,426,52a9
varint,427,da50
varbit,427,56a9
varint,428,3a50
varbit,428,51a9
varint,429,ba50
varbit,429,55a9
varint,430,7a50
varbit,430,53a9
varint,431,fa50
varbit,431,57a9
varint,432,0e50
varbit,432,5069
varint,433,8e50
varbit,433,5469
varint,434,4e50
varbit,434,5269
varint,435,ce50
varbit,435,5669
varint,436,2e50
varbit,436,5169
varint,437,ae50
varbit,437,5569
varint,438,6e50
varbit,438,5369
varint,439,ee50
varbit,439,5769
varint,440,1e50
varbit,440,50e9
varint,441,9e50
varbit,441,54e9
varint,442,5e50
varbit,442,52e9
varint,443,de50
varbit,443,56e9
varint,444,3e50
varbit,444,51e9
varint,445,be50
varbit,445,55e9
varint,446,7e50
varbit,446,53e9
varint,447,fe50
varbit,447,57e9
varint,448,0950
varbit,448,5019
varint,449,8950
varbit,449,5419
varint,450,4950
varbit,450,5219
varint,451,c950
varbit,451,5619
varint,452,2950
varbit,452,5119
varint,453,a950
varbit,453,5519
varint,454,6950
varbit,454,5319
varint,455,e950
varbit,455,5719
varint,456,1950
varbit,456,5099
varint,457,9950
varbit,457,5499
varint,458,5950
varbit,458,5299
varint,459,d950
varbit,459,5699
varint,460,3950
varbit,460,5199
varint,461,b950
varbit,461,5599
varint,462,7950
varbit,462,5399
varint,463,f950
varbit,463,5799
varint,464,0d50
varbit,464,5059
varint,465,8d50
varbit,465,5459
varint,466,4d50
varbit,466,5259
varint,467,cd50
varbit,467,5659
varint,468,2d50
varbit,468,5159
varint,469,ad50
varbit,469,5559
varint,470,6d50
varbit,470,5359
varint,471,ed50
varbit,471,5759
varint,472,1d50
varbit,472,50d9
varint,473,9d50
varbit,473,54d9
varint,474,5d50
varbit,474,52d9
varint,475,dd50
varbit,475,56d9
varint,476,3d50
varbit,476,51d9
varint,477,bd50
varbit,477,55d9
varint,478,7d50
varbit,478,53d9
varint,479,fdd0
varbit,479,57d9
varint,480,0b50
varbit,480,5039
varint,481,8b50
varbit,481,5439
varint,482,4b50
varbit,482,5239
varint,483,cb50
varbit,483,5639
varint,484,2b50
varbit,484,5139
varint,485,ab50
varbit,485,5539
varint,486,6b50
varbit,486,5339
varint,487,eb50
varbit,487,5739
varint,488,1b50
varbit,488,50b9
varint,489,9b50
varbit,489,54b9
varint,490,5b50
varbit,490,52b9
varint,491,db50
varbit,491,56b9
varint,492,3b50
varbit,492,51b9
varint,493,bb50
varbit,493,55b9
varint,494,7b50
varbit,494,53b9
varint,495,fb50
varbit,495,57b9
varint,496,0f50
varbit,496,5079
varint,497,8f50
varbit,497,5479
varint,498,4f50
varbit,498,5279
varint,499,cf50
varbit,499,5679
varint,500,2f50
varbit,500,5179
varint,501,af50
varbit,501,5579
varint,502,6f50
varbit,502,5379
varint,503,ef50
varbit,503,5779
varint,504,1f50
varbit,504,50f9
varint,505,9f50
varbit,505,54f9
varint,506,5f50
varbit,506,52f9
varint,507,df50
varbit,507,56f9
varint,508,3f50
varbit,508,51f9
varint,509,bf50
varbit,509,55f9
varint,510,7f50
varbit,510,53f9
varint,511,ff50
varbit,511,57f9
varint,512,0850
varbit,512,5002
varint,513,8850
varbit,513,5402
varint,514,4850
varbit,514,5202
varint,515,c850
varbit,515,5602
varint,516,2850
varbit,516,5102
varint,517,a850
varbit,517,5502
varint,518,6850
varbit,518,5302
varint,519,e850
varbit,519,5702
varint,520,1850
varbit,520,5082
varint,521,9850
varbit,521,5482
varint,522,5850
varbit,522,5282
varint,523,d850
varbit,523,5682
varint,524,3850
varbit,524,5182
varint,525,b850
varbit,525,5582
varint,526,7850
varbit,526,5382
varint,527,f850
varbit,527,5782
varint,528,0c50
varbit,528,5042
varint,529,8c50
varbit,529,5442
varint,530,4c50
varbit,530,5242
varint,531,cc50
varbit,531,5642
varint,532,2c50
varbit,532,5142
varint,533,ac50
varbit,533,5542
varint,534,6c50
varbit,534,5342
varint,535,ec50
varbit,535,5742
varint,536,1c50
varbit,536,50c2
varint,537,9c50
varbit,537,54c2
varint,538,5c50
varbit,538,52c2
varint,539,dc50
varbit,539,56c2
varint,540,3c50
varbit,540,51c2
varint,541,bc50
varbit,541,55c2
varint,542,7c50
varbit,542,53c2
varint,543,fc50
varbit,543,57c2
varint,544,0a50
varbit,544,5022
varint,545,8a50
varbit,545,5422
varint,546,4a50
varbit,546,5222
varint,547,ca50
varbit,547,5622
varint,548,2a50
varbit,548,5122
varint,549,aa50
varbit,549,5522
varint,550,6a50
varbit,550,5322
varint,551,ea50
varbit,551,5722
varint,552,1a50
varbit,552,50a2
varint,553,9a50
varbit,553,54a2
varint,554,5a50
varbit,554,52a2
varint,555,da50
varbit,555,56a2
varint,556,3a50
varbit,556,51a2
varint,557,ba50
varbit,557,55a2
varint,558,7a50
varbit,558,53a2
varint,559,fa50
varbit,559,57a2
varint,560,0e50
varbit,560,5062
varint,561,8e50
varbit,561,5462
varint,562,4e50
varbit,562,5262
varint,563,ce50
varbit,563,5662
varint,564,2e50
varbit,564,5162
varint,565,ae50
varbit,565,5562
varint,566,6e50
varbit,566,5362
varint,567,ee50
varbit,567,5762
varint,568,1e50
varbit,568,50e2
varint,569,9e50
varbit,569,54e2
varint,570,5e50
varbit,570,52e2
varint,571,de50
varbit,571,56e2
varint,572,3e50
varbit,572,51e2
varint,573,be50
varbit,573,55e2
varint,574,7e50
varbit,574,53e2
varint,575,fe50
varbit,575,57e2
varint,576,0950
varbit,576,5012
varint,577,8950
varbit,577,5412
varint,578,4950
varbit,578,5212
varint,579,c950
varbit,579,5612
varint,580,2950
varbit,580,5112
varint,581,a950
varbit,581,5512
varint,582,6950
varbit,582,5312
varint,583,e950
varbit,583,5712
varint,584,1950
varbit,584,5092
varint,585,9950
varbit,585,5492
varint,586,5950
varbit,586,5292
varint,587,d950
varbit,587,5692
varint,588,3950
varbit,588,5192
varint,589,b950
varbit,589,5592
varint,590,7950
varbit,590,5392
varint,591,f950
varbit,591,5792
varint,592,0d50
varbit,592,5052
varint,593,8d50
varbit,593,5452
varint,594,4d50
varbit,594,5252
varint,595,cd50
varbit,595,5652
varint,596,2d50
varbit,596,5152
varint,597,ad50
varbit,597,5552
varint,598,6d50
varbit,598,5352
varint,599,ed50
varbit,599,5752
varint,600,1d50
varbit,600,50d2
varint,601,9d50
varbit,601,54d2
varint,602,5d50
varbit,602,52d2
varint,603,dd50
varbit,603,56d2
varint,604,3d50
varbit,604,51d2
varint,605,bd50
varbit,605,55d2
varint,606,7d50
varbit,606,53d2
varint,607,fd50
varbit,607,57d2
varint,608,0b50
varbit,608,5032
varint,609,8b50
varbit,609,5432
varint,610,4b50
varbit,610,5232
varint,611,cb50
varbit,611,5632
varint,612,2b50
varbit,612,5132
varint,613,ab50
varbit,613,5532
varint,614,6b50
varbit,614,5332
varint,615,eb50
varbit,615,5732
varint,616,1b50
varbit,616,50b2
varint,617,9b50
varbit,617,54b2
varint,618,5b50
varbit,618,52b2
varint,619,db50
varbit,619,56b2
varint,620,3b50
varbit,620,51b2
varint,621,bb50
varbit,621,55b2
varint,622,7b50
varbit,622,53b2
varint,623,fb50
varbit,623,57b2
varint,624,0f50
varbit,624,5072
varint,625,8f50
varbit,625,5472
varint,626,4f50
varbit,626,5272
varint,627,cf50
varbit,627,5672
varint,628,2f50
varbit,628,5172
varint,629,af50
varbit,629,5572
varint,630,6f50
varbit,630,5372
varint,631,ef50
varbit,631,5772
varint,632,1f50
varbit,632,50f2
varint,633,9f50
varbit,633,54f2
varint,634,5f50
varbit,634,52f2
varint,635,df50
varbit,635,56f2
varint,636,3f50
varbit,636,51f2
varint,637,bf50
varbit,637,55f2
varint,638,7f50
varbit,638,53f2
varint,639,ff50
varbit,639,57f2
varint,640,08d0
varbit,640,500a
varint,641,88d0
varbit,641,540a
varint,642,48d0
varbit,642,520a
varint,643,c8d0
varbit,643,560a
varint,644,28d0
varbit,644,510a
varint,645,a8d0
varbit,645,550a
varint,646,68d0
varbit,646,530a
varint,647,e8d0
varbit,647,570a
varint,648,18d0
varbit,648,508a
varint,649,98d0
varbit,649,548a
varint,650,58d0
varbit,650,528a
varint,651,d8d0
varbit,651,568a
varint,652,38d0
varbit,652,518a
varint,653,b8d0
varbit,653,558a
varint,654,78d0
varbit,654,538a
varint,655,f8d0
varbit,655,578a
varint,656,0cd0
varbit,656,504a
varint,657,8cd0
varbit,657,544a
varint,658,4cd0
varbit,658,524a
varint,659,ccd0
varbit,659,564a
varint,660,2cd0
varbit,660,514a
varint,661,acd0
varbit,661,554a
varint,662,6cd0
varbit,662,534a
varint,663,ecd0
varbit,663,574a
varint,664,1cd0
varbit,664,50ca
varint,665,9cd0
varbit,665,54ca
varint,666,5cd0
varbit,666,52ca
varint,667,dcd0
varbit,667,56ca
varint,668,3cd0
varbit,668,51ca
varint,669,bcd0
varbit,669,55ca
varint,670,7cd0
varbit,670,53ca
varint,671,fcd0
varbit,671,57ca
varint,672,0ad0
varbit,672,502a
varint,673,8ad0
varbit,673,542a
varint,674,4ad0
varbit,674,522a
varint,675,cad0
varbit,675,562a
varint,676,2ad0
varbit,676,512a
varint,677,aad0
varbit,677,552a
varint,678,6ad0
varbit,678,532a
varint,679,ead0
varbit,679,572a
varint,680,1ad0
varbit,680,50aa
varint,681,9ad0
varbit,681,54aa
varint,682,5ad0
varbit,682,52aa
varint,683,dad0
varbit,683,56aa
varint,684,3ad0
varbit,684,51aa
varint,685,bad0
varbit,685,55aa
varint,686,7ad0
varbit,686,53aa
varint,687,fad0
varbit,687,57aa
varint,688,0ed0
varbit,688,506a
varint,689,8ed0
varbit,689,546a
varint,690,4ed0
varbit,690,526a
varint,691,ced0
varbit,691,566a
varint,692,2ed0
varbit,692,516a
varint,693,aed0
varbit,693,556a
varint,694,6ed0
varbit,694,536a
varint,695,eed0
varbit,695,576a
varint,696,1ed0
varbit,696,50ea
varint,697,9ed0
varbit,697,54ea
varint,698,5ed0
varbit,698,52ea
varint,699,ded0
varbit,699,56ea
varint,700,3ed0
varbit,700,51ea
varint,701,bed0
varbit,701,55ea
varint,702,7ed0
varbit,702,53ea
varint,703,fed0
varbit,703,57ea
varint,704,09d0
varbit,704,501a
varint,705,89d0
varbit,705,541a
varint,706,49d0
varbit,706,521a
varint,707,c9d0
varbit,707,561a
varint,708,29d0
varbit,708,511a
varint,709,a9d0
varbit,709,551a
varint,710,69d0
varbit,710,531a
varint,711,e9d0
varbit,711,571a
varint,712,19d0
varbit,712,509a
varint,713,99d0
varbit,713,549a
varint,714,59d0
varbit,714,529a
varint,715,d9d0
varbit,715,569a
varint,716,39d0
varbit,716,519a
varint,717,b9d0
varbit,717,559a
varint,718,79d0
varbit,718,539a
varint,719,f9d0
varbit,719,579a
varint,720,0dd0
varbit,720,505a
varint,721,8dd0
varbit,721,545a
varint,722,4dd0
varbit,722,525a
varint,723,cdd0
varbit,723,565a
varint,724,2dd0
varbit,724,515a
varint,725,add0
varbit,725,555a
varint,726,6dd0
varbit,726,535a
varint,727,edd0
varbit,727,575a
varint,728,1dd0
varbit,728,50da
varint,729,9dd0
varbit,729,54da
varint,730,5dd0
varbit,730,52da
varint,731,ddd0
varbit,731,56da
varint,732,3dd0
varbit,732,51da
varint,733,bdd0
varbit,733,55da
varint,734,7dd0
varbit,734,53da
varint,735,fdd0
varbit,735,57da
varint,736,0bd0
varbit,736,503a
varint,737,8bd0
varbit,737,543a
varint,738,4bd0
varbit,738,523a
varint,739,cbd0
varbit,739,563a
varint,740,2bd0
varbit,740,513a
varint,741,abd0
varbit,741,553a
varint,742,6bd0
varbit,742,533a
varint,743,ebd0
varbit,743,573a
varint,744,1bd0
varbit,744,50ba
varint,745,9bd0
varbit,745,54ba
varint,746,5bd0
varbit,746,52ba
varint,747,dbd0
varbit,747,56ba
varint,748,3bd0
varbit,748,51ba
varint,749,bbd0
varbit,749,55ba
varint,750,7bd0
varbit,750,53ba
varint,751,fbd0
varbit,751,57ba
varint,752,0fd0
varbit,752,507a
varint,753,8fd0
varbit,753,547a
varint,754,4fd0
varbit,754,527a
varint,755,cfd0
varbit,755,567a
varint,756,2fd0
varbit,756,517a
varint,757,afd0
varbit,757,557a
varint,758,6fd0
varbit,758,537a
varint,759,efd0
varbit,759,577a
varint,760,1fd0
varbit,760,50fa
varint,761,9fd0
varbit,761,54fa
varint,762,5fd0
varbit,762,52fa
varint,763,dfd0
varbit,763,56fa
varint,764,3fd0
varbit,764,51fa
varint,765,bfd0
varbit,765,55fa
varint,766,7fd0
varbit,766,53fa
varint,767,ffd0
varbit,767,57fa
varint,768,0870
varbit,768,5006
varint,769,8870
varbit,769,5406
varint,770,4870
varbit,770,5206
varint,771,c870
varbit,771,5606
varint,772,2870
varbit,772,5106
varint,773,a870
varbit,773,5506
varint,774,6870
varbit,774,5306
varint,775,e870
varbit,775,5706
varint,776,1870
varbit,776,5086
varint,777,9870
varbit,777,5486
varint,778,5870
varbit,778,5286
varint,779,d870
varbit,779,5686
varint,780,3870
varbit,780,5186
varint,781,b870
varbit,781,5586
varint,782,7870
varbit,782,5386
varint,783,f870
varbit,783,5786
varint,784,0c70
varbit,784,5046
varint,785,8c70
varbit,785,5446
varint,786,4c70
varbit,786,5246
varint,787,cc70
varbit,787,5646
varint,788,2c70
varbit,788,5146
varint,789,ac70
varbit,789,5546
varint,790,6c70
varbit,790,5346
varint,791,ec70
varbit,791,5746
varint,792,1c70
varbit,792,50c6
varint,793,9c70
varbit,793,54c6
varint,794,5c70
varbit,794,52c6
varint,795,dc70
varbit,795,56c6
varint,796,3c70
varbit,796,51c6
varint,797,bc70
varbit,797,55c6
varint,798,7c70
varbit,798,53c6
varint,799,fc70
varbit,799,57c6
varint,800,0a70
varbit,800,5026
varint,801,8a70
varbit,801,5426
varint,802,4a70
varbit,802,5226
varint,803,ca70
varbit,803,5626
varint,804,2a70
varbit,804,5126
varint,805,aa70
varbit,805,5526
varint,806,6a70
varbit,806,5326
varint,807,ea70
varbit,807,5726
varint,808,1a70
varbit,808,50a6
varint,809,9a70
varbit,809,54a6
varint,810,5a70
varbit,810,52a6
varint,811,da70
varbit,811,56a6
varint,812,3a70
varbit,812,51a6
varint,813,ba70
varbit,813,55a6
varint,814,7a70
varbit,814,53a6
varint,815,fa70
varbit,815,57a6
varint,816,0e70
varbit,816,5066
varint,817,8e70
varbit,817,5466
varint,818,4e70
varbit,818,5266
varint,819,ce70
varbit,819,5666
varint,820,2e70
varbit,820,5166
varint,821,ae70
varbit,821,5566
varint,822,6e70
varbit,822,5366
varint,823,ee70
varbit,823,5766
varint,824,1e70
varbit,824,50e6
varint,825,9e70
varbit,825,54e6
varint,826,5e70
varbit,826,52e6
varint,827,de70
varbit,827,56e6
varint,828,3e70
varbit,828,51e6
varint,829,be70
varbit,829,55e6
varint,830,7e70
varbit,830,53e6
varint,831,fe70
varbit,831,57e6
varint,832,0970
varbit,832,5016
varint,833,8970
varbit,833,5416
varint,834,4970
varbit,834,5216
varint,835,c970
varbit,835,5616
varint,836,2970
varbit,836,5116
varint,837,a970
varbit,837,5516
varint,838,6970
varbit,838,5316
varint,839,e970
varbit,839,5716
varint,840,1970
varbit,840,5096
varint,841,9970
varbit,841,5496
varint,842,5970
varbit,842,5296
varint,843,d970
varbit,843,5696
varint,844,3970
varbit,844,5196
varint,845,b970
varbit,845,5596
varint,846,7970
varbit,846,5396
varint,847,f970
varbit,847,5796
varint,848,0d70
varbit,848,5056
varint,849,8d70
varbit,849,5456
varint,850,4d70
varbit,850,5256
varint,851,cd70
varbit,851,5656
varint,852,2d70
varbit,852,5156
varint,853,ad70
varbit,853,5556
varint,854,6d70
varbit,854,5356
varint,855,ed70
varbit,855,5756
varint,856,1d70
varbit,856,50d6
varint,857,9d70
varbit,857,54d6
varint,858,5d70
varbit,858,52d6
varint,859,dd70
varbit,859,56d6
varint,860,3d70
varbit,860,51d6
varint,861,bd70
varbit,861,55d6
varint,862,7d70
varbit,862,53d6
varint,863,fd70
varbit,863,57d6
varint,864,0b70
varbit,864,5036
varint,865,8b70
varbit,865,5436
varint,866,4b70
varbit,866,5236
varint,867,cb70
varbit,867,5636
varint,868,2b70
varbit,868,5136
varint,869,ab70
varbit,869,5536
varint,870,6b70
varbit,870,5336
varint,871,eb70
varbit,871,5736
varint,872,1b70
varbit,872,50b6
varint,873,9b70
varbit,873,54b6
varint,874,5b70
varbit,874,52b6
varint,875,db70
varbit,875,56b6
varint,876,3b70
varbit,876,51b6
varint,877,bb70
varbit,877,55b6
varint,878,7b70
varbit,878,53b6
varint,879,fb70
varbit,879,57b6
varint,880,0f70
varbit,880,5076
varint,881,8f70
varbit,881,5476
varint,882,4f70
varbit,882,5276
varint,883,cf70
varbit,883,5676
varint,884,2f70
varbit,884,5176
varint,885,af70
varbit,885,5576
varint,886,6f70
varbit,886,5376
varint,887,ef70
varbit,887,5776
varint,888,1f70
varbit,888,50f6
varint,889,9f70
varbit,889,54f6
varint,890,5f70
varbit,890,52f6
varint,891,df70
varbit,891,56f6
varint,892,3f70
varbit,892,51f6
varint,893,bf70
varbit,893,55f6
varint,894,7f70
varbit,894,53f6
varint,895,ff70
varbit,895,57f6
varint,896,08f0
varbit,896,500e
varint,897,88f0
varbit,897,540e
varint,898,48f0
varbit,898,520e
varint,899,c8f0
varbit,899,560e
varint,900,28f0
varbit,900,510e
varint,901,a8f0
varbit,901,550e
varint,902,68f0
varbit,902,530e
varint,903,e8f0
varbit,903,570e
varint,904,18f0
varbit,904,508e
varint,905,98f0
varbit,905,548e
varint,906,58f0
varbit,906,528e
varint,907,d8f0
varbit,907,568e
varint,908,38f0
varbit,908,518e
varint,909,b8f0
varbit,909,558e
varint,910,78f0
varbit,910,538e
varint,911,f8f0
varbit,911,578e
varint,912,0cf0
varbit,912,504e
varint,913,8cf0
varbit,913,544e
varint,914,4cf0
varbit,914,524e
varint,915,ccf0
varbit,915,564e
varint,916,2cf0
varbit,916,514e
varint,917,acf0
varbit,917,554e
varint,918,6cf0
varbit,918,534e
varint,919,ecf0
varbit,919,574e
varint,920,1cf0
varbit,920,50ca
varint,921,9cf0
varbit,921,54ca
varint,922,5cf0
varbit,922,52ca
varint,923,dcf0
varbit,923,56ca
varint,924,3cf0
varbit,924,51ca
varint,925,bcf0
varbit,925,55ca
varint,926,7cf0
varbit,926,53ca
varint,927,fcf0
varbit,927,57ca
varint,928,0af0
varbit,928,502e
varint,929,8af0
varbit,929,542e
varint,930,4af0
varbit,930,522e
varint,931,caf0
varbit,931,562e
varint,932,2af0
varbit,932,512e
varint,933,aaf0
varbit,933,552e
varint,934,6af0
varbit,934,532e
varint,935,eaf0
varbit,935,572e
varint,936,1af0
varbit,936,50ae
varint,937,9af0
varbit,937,54ae
varint,938,5af0
varbit,938,52ae
varint,939,daf0
varbit,939,56ae
varint,940,3af0
varbit,940,51ae
varint,941,baf0
varbit,941,55ae
varint,942,7af0
varbit,942,53ae
varint,943,faf0
varbit,943,57ae
varint,944,0ef0
varbit,944,506e
varint,945,8ef0
varbit,945,546e
varint,946,4ef0
varbit,946,526e
varint,947,cef0
varbit,947,566e
varint,948,2ef0
varbit,948,516e
varint,949,aef0
varbit,949,556e
varint,950,6ef0
varbit,950,536e
varint,951,eef0
varbit,951,576e
varint,952,1ef0
varbit,952,50ee
varint,953,9ef0
varbit,953,54ee
varint,954,5ef0
varbit,954,52ee
varint,955,def0
varbit,955,56ee
varint,956,3ef0
varbit,956,51ee
varint,957,bef0
varbit,957,55ee
varint,958,7ef0
varbit,958,53ee
varint,959,fef0
varbit,959,57ee
varint,960,09f0
varbit,960,501e
varint,961,89f0
varbit,961,541e
varint,962,49f0
varbit,962,521e
varint,963,c9f0
varbit,963,561e
varint,964,29f0
varbit,964,511e
varint,965,a9f0
varbit,965,551e
varint,966,69f0
varbit,966,531e
varint,967,e9f0
varbit,967,571e
varint,968,19f0
varbit,968,509e
varint,969,99f0
varbit,969,549e
varint,970,59f0
varbit,970,529e
varint,971,d9f0
varbit,971,569e
varint,972,39f0
varbit,972,519e
varint,973,b9f0
varbit,973,559e
varint,974,79f0
varbit,974,539e
varint,975,f9f0
varbit,975,579e
varint,976,0df0
varbit,976,505e
varint,977,8df0
varbit,977,545e
varint,978,4df0
varbit,978,525e
varint,979,cdf0
varbit,979,565e
varint,980,2df0
varbit,980,515e
varint,981,adf0
varbit,981,555e
varint,982,6df0
varbit,982,535e
varint,983,edf0
varbit,983,575e
varint,984,1df0
varbit,984,50de
varint,985,9df0
varbit,985,54de
varint,986,5df0
varbit,986,52de
varint,987,ddf0
varbit,987,56de
varint,988,3df0
varbit,988,51de
varint,989,bdf0
varbit,989,55de
varint,990,7df0
varbit,990,53de
varint,991,fdf0
varbit,991,57de
varint,992,0bf0
varbit,992,503e
varint,993,8bf0
varbit,993,543e
varint,994,4bf0
varbit,994,523e
varint,995,cbf0
varbit,995,563e
varint,996,2bf0
varbit,996,513e
varint,997,abf0
varbit,997,553e
varint,998,6bf0
varbit,998,533e
varint,999,ebf0
varbit,999,573e
`;

const goData: { type: string; value: number; hex: string }[] = [];
goOutput.trim().split('\n').forEach(line => {
    const [type, value, hex] = line.split(',');
    goData.push({ type, value: parseInt(value, 10), hex });
});

// Mock Bitstream for testing write functions
class MockBitstream extends Bitstream {
    public writtenBits: number[] = [];

    writeBit(bit: number) {
        this.writtenBits.push(bit);
        super.writeBit(bit);
    }

    write(value: number, n: number) {
        for (let i = 0; i < n; i++) {
            this.writtenBits.push((value >> (n - 1 - i)) & 1);
        }
        super.write(value, n);
    }
}

// Import the functions to test
import { writeVarint, writeVarbit, getVarintNumBits, getVarbitNumBits } from './encoder';

describe('Varint and Varbit Encoding Comparison with Go', () => {
    goData.filter(d => d.type === 'varint').forEach(data => {
        it(`should encode varint ${data.value} correctly`, () => {
            const stream = new MockBitstream(new Uint8Array(10));
            writeVarint(stream, data.value);
            const encodedBytes = stream.bytes.slice(0, Math.ceil(stream.bit_pos / 8));
            const encodedHex = Array.from(encodedBytes).map(b => b.toString(16).padStart(2, '0')).join('');
            expect(encodedHex).toBe(data.hex);
        });
    });

    goData.filter(d => d.type === 'varbit').forEach(data => {
        it(`should encode varbit ${data.value} correctly`, () => {
            const stream = new MockBitstream(new Uint8Array(10));
            writeVarbit(stream, data.value);
            const encodedBytes = stream.bytes.slice(0, Math.ceil(stream.bit_pos / 8));
            const encodedHex = Array.from(encodedBytes).map(b => b.toString(16).padStart(2, '0')).join('');
            expect(encodedHex).toBe(data.hex);
        });
    });
});
